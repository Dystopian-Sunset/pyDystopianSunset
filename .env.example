# ============================================
# Configuration
# ============================================
# This file provides environment variable overrides for configuration.
# For a complete configuration setup, see config.example.toml
# 
# Configuration is loaded in this order (later values override earlier):
# 1. Default values (in config.py)
# 2. config.toml file (if it exists)
# 3. Environment variables (this file, highest priority)
#
# ‚ö†Ô∏è  SECURITY BEST PRACTICE ‚ö†Ô∏è
# Store ALL secrets (tokens, passwords, API keys) in this .env file, NOT in config.toml.
# The .env file should be in .gitignore and never committed to version control.
# Use config.toml only for non-sensitive configuration values.
#
# üìù ENVIRONMENT VARIABLE NAMING
# All environment variables use the DS_ prefix to avoid conflicts with other services.
# Old variable names (DB_*, GAME_*, OPENAI_*, REDIS_*) are deprecated but still supported
# for backward compatibility. You'll see deprecation warnings when using old names.
#
# Copy config.example.toml to config.toml for TOML-based configuration,
# or use this .env file for environment variable overrides.

# ============================================
# Discord Bot Configuration
# ============================================
# Discord Bot Token (required)
DS_DISCORD_TOKEN="your_discord_bot_token_here"

# Discord Application ID (optional, for slash commands)
DS_DISCORD_APP_ID="your_discord_app_id_here"

# Discord Application Public Key (optional, for interactions)
DS_DISCORD_APP_PUBLIC_KEY="your_discord_public_key_here"

# Comma-separated list of extensions to load (optional, loads all if not set)
# Available extensions: ADMIN, CHARACTER, GAME, GENERAL, MODERATION, PLAYER, WELCOME
DS_EXTENSIONS=""

# ============================================
# PostgreSQL Database Configuration
# ============================================
# PostgreSQL connection settings
DS_POSTGRES_HOST="localhost"
DS_POSTGRES_PORT="5432"
DS_POSTGRES_DATABASE="game"
DS_POSTGRES_USER="postgres"
DS_POSTGRES_PASSWORD="postgres"

# Connection pool settings (optional)
DS_POSTGRES_POOL_SIZE="5"
DS_POSTGRES_MAX_OVERFLOW="10"

# Enable SQL query logging (optional, default: false)
# Set to "true" to log all SQL queries (useful for debugging)
DS_POSTGRES_ECHO="false"

# ============================================
# Game Configuration
# ============================================
# Game session category name in Discord (default: "Speakeasy")
# Note: Old name GAME_SESSION_CATEGORY_NAME is deprecated but still supported
DS_GAME_SESSION_CATEGORY_NAME="Speakeasy"

# Game session join channel name (default: "Join-to-Play")
# Note: Old name GAME_SESSION_JOIN_CHANNEL_NAME is deprecated but still supported
DS_GAME_SESSION_JOIN_CHANNEL_NAME="Join-to-Play"

# Service announcements channel name (optional, default: "üìü-service-announcements")
# Global service status updates (maintenance, outages, etc.) will be posted here if configured
# If not set or channel doesn't exist, announcements will only be sent via DM to active players
DS_GAME_SERVICE_ANNOUNCEMENTS_CHANNEL_NAME="üìü-service-announcements"

# ============================================
# AI Game Master Configuration
# ============================================
# AI model name for the Game Master (default: "gpt-oss:latest")
# This is used with pydantic-ai for generating game responses
# Note: Old name DB_GM_MODEL_NAME is deprecated but still supported
DS_AI_GM_MODEL_NAME="gpt-oss"

# Base URL for the AI model API (default: "http://localhost:11434/v1")
# For local Ollama: "http://localhost:11434/v1"
# For OpenAI: "https://api.openai.com/v1"
# Note: Old name DB_GM_BASE_URL is deprecated but still supported
DS_AI_GM_BASE_URL="http://localhost:11434/v1"

# OpenAI API Key for Game Master (optional, only needed if using OpenAI's API)
# Required if using OpenAI's API (DS_AI_GM_BASE_URL set to OpenAI endpoint or empty)
# Not needed if using local services like Ollama (set DS_AI_GM_BASE_URL instead)
# If not set and using OpenAI, will fall back to OPENAI_API_KEY environment variable
# Note: This is separate from DS_AI_EMBEDDING_API_KEY - you can use different keys
#       for the GM and embedding services if needed
# Get your API key from: https://platform.openai.com/api-keys
DS_AI_GM_API_KEY=""

# Path to the Game Master system prompt file (optional)
# If not set, uses the default prompt in extensions/prompts/gm_base.md
# Note: Old name DB_GM_SYSTEM_PROMPT_PATH is deprecated but still supported
DS_AI_GM_SYSTEM_PROMPT_PATH=""

# ============================================
# Embedding Service Configuration (for AI-based features)
# ============================================
# Base URL for embedding API (optional, for local services like Ollama)
# If using Ollama locally: "http://localhost:11434/v1"
# If using OpenAI: leave empty (uses OpenAI's default API endpoint)
# If not set and DS_AI_EMBEDDING_API_KEY is not set, AI-based features will be disabled
# Note: Old name DB_EMBEDDING_BASE_URL is deprecated but still supported
DS_AI_EMBEDDING_BASE_URL=""

# OpenAI API Key (optional, only needed if using OpenAI's embedding API)
# Required if using OpenAI's embedding API (DS_AI_EMBEDDING_BASE_URL not set)
# Not needed if using local services like Ollama (set DS_AI_EMBEDDING_BASE_URL instead)
# If neither is set, the system will use keyword matching for prompt analysis
# Note: The Game Master AI (DS_AI_GM_BASE_URL) works independently and can use
#       Ollama or other OpenAPI-compliant services without this key
# Note: Old name OPENAI_API_KEY is deprecated but still supported
# Get your API key from: https://platform.openai.com/api-keys
DS_AI_EMBEDDING_API_KEY=""

# Embedding model for memory system (semantic search of stored memories)
# For OpenAI: "text-embedding-3-small", "text-embedding-3-large"
# For Ollama: "nomic-embed-text" (768 dimensions)
# ‚ö†Ô∏è  IMPORTANT: Changing the model/dimensions requires a database schema migration!
#     Use the utility script: python scripts/manage_embedding_model.py
#     This will update the schema and regenerate embeddings if needed.
DS_AI_EMBEDDING_MODEL="nomic-embed-text"

# Embedding dimensions for memory system (must match database schema)
# ‚ö†Ô∏è  IMPORTANT: This MUST match the database schema. Changing this requires:
#     1. Running a database migration to update vector column dimensions
#     2. Regenerating all existing embeddings (they will be incompatible)
#     Use the utility script: python scripts/manage_embedding_model.py
# Common dimensions:
#   nomic-embed-text: 768
#   text-embedding-3-small: 1536
#   text-embedding-3-large: 3072
DS_AI_EMBEDDING_DIMENSIONS="768"

# ============================================
# Redis Configuration (for Embedding Cache)
# ============================================
# Redis connection URL (optional, for caching embeddings)
# If not set, embeddings will not be cached
# Format: "redis://localhost:6379" or "redis://user:password@host:port"
# Note: Old name REDIS_URL is deprecated but still supported
DS_REDIS_URL="redis://localhost:6379"

# Redis database number for prompt analyzer embeddings (default: 0)
# Separate databases allow independent cache management for different embedding use cases
DS_REDIS_DB_PROMPT_ANALYZER="0"

# Redis database number for memory system embeddings (default: 1)
# Memory embeddings include: episode summaries, world memories, semantic search queries
DS_REDIS_DB_MEMORY="1"

# ============================================
# Prompt Analyzer Configuration
# ============================================
# Enable AI-based intent classification (default: "true")
# Set to "false" to use keyword matching only
# Requires either DS_AI_EMBEDDING_BASE_URL or DS_AI_EMBEDDING_API_KEY to be set
# If neither is set, this will automatically fall back to keyword matching
# Note: Old name DB_PROMPT_ANALYZER_USE_AI is deprecated but still supported
DS_PROMPT_ANALYZER_USE_AI="true"

# AI confidence threshold for classification (default: "0.7")
# Higher values require stronger AI confidence
# Note: Old name DB_PROMPT_ANALYZER_AI_THRESHOLD is deprecated but still supported
DS_PROMPT_ANALYZER_AI_THRESHOLD="0.7"

# Use AI to validate keyword matches (default: "true")
# When true, AI can override keyword matches if confidence is low
# Note: Old name DB_PROMPT_ANALYZER_AI_VALIDATE is deprecated but still supported
DS_PROMPT_ANALYZER_AI_VALIDATE="true"

# Embedding model for AI classification (default: "text-embedding-3-small")
# For OpenAI: "text-embedding-3-small", "text-embedding-3-large"
# For Ollama: "nomic-embed-text", "nomic-embed-text-v1.5", etc.
# Must match a model available at your embedding service (DS_AI_EMBEDDING_BASE_URL or OpenAI)
# Note: Old name DB_PROMPT_ANALYZER_EMBEDDING_MODEL is deprecated but still supported
DS_PROMPT_ANALYZER_EMBEDDING_MODEL="nomic-embed-text"

# Embedding dimensions (default: "1536")
# Note: Old name DB_PROMPT_ANALYZER_EMBEDDING_DIMENSIONS is deprecated but still supported
DS_PROMPT_ANALYZER_EMBEDDING_DIMENSIONS="1536"

# Use keywords only, disable AI (default: "false")
# Overrides DS_PROMPT_ANALYZER_USE_AI when set to "true"
# Note: Old name DB_PROMPT_ANALYZER_KEYWORDS_ONLY is deprecated but still supported
DS_PROMPT_ANALYZER_KEYWORDS_ONLY="false"

# Use AI only as fallback when keywords fail (default: "false")
# When true, AI is only used for categories where keywords didn't match
# Note: Old name DB_PROMPT_ANALYZER_AI_FALLBACK_ONLY is deprecated but still supported
DS_PROMPT_ANALYZER_AI_FALLBACK_ONLY="false"

# ============================================
# Conversation Classifier Configuration
# ============================================
# Enable conversation actionability classification (default: "true")
# Determines if messages require GM involvement or are player-to-player chat
DS_CONVERSATION_CLASSIFIER_ENABLED="true"

# Use AI-based classification (default: "true")
# Requires embedding service (DS_AI_EMBEDDING_BASE_URL or DS_AI_EMBEDDING_API_KEY)
DS_CONVERSATION_CLASSIFIER_USE_AI="true"

# AI confidence threshold for classification (default: "0.7")
# Messages below this threshold are treated as ambiguous
DS_CONVERSATION_CLASSIFIER_AI_THRESHOLD="0.7"

# Use keywords only, disable AI (default: "false")
DS_CONVERSATION_CLASSIFIER_KEYWORDS_ONLY="false"

# Minimum confidence to skip GM processing for player_chat (default: "0.8")
# If player_chat confidence >= this, skip GM entirely
DS_CONVERSATION_CLASSIFIER_SKIP_THRESHOLD="0.8"

# ============================================
# Memory Configuration
# ============================================
# Maximum number of memories to keep (default: "12")
# Note: These settings are deprecated in favor of database game_settings table
#       but can still be used as fallback configuration
DS_MEMORY_MAX_MEMORIES="12"

# Maximum number of recent memories to keep (default: "8")
DS_MEMORY_MAX_RECENT_MEMORIES="8"

# Importance threshold for memory compression (default: "0.3")
DS_MEMORY_IMPORTANCE_THRESHOLD="0.3"

# Recent memory cutoff in minutes (default: "30")
DS_MEMORY_RECENT_CUTOFF_MINUTES="30"

# Description truncate length for memories (default: "400")
DS_MEMORY_DESCRIPTION_TRUNCATE_LENGTH="400"

# Environmental items lookback in minutes (default: "30")
DS_MEMORY_ENVIRONMENTAL_ITEMS_LOOKBACK_MINUTES="30"

# ============================================
# PostgreSQL Read Replica Configuration (optional)
# ============================================
# Enable read replica for database queries (default: "false")
# When enabled, read queries will use the replica, writes use primary
DS_POSTGRES_READ_REPLICA_ENABLED="false"

# Read replica connection settings (only used if enabled)
DS_POSTGRES_READ_REPLICA_HOST="localhost"
DS_POSTGRES_READ_REPLICA_PORT="5432"
DS_POSTGRES_READ_REPLICA_DATABASE="game"
DS_POSTGRES_READ_REPLICA_USER="postgres"
DS_POSTGRES_READ_REPLICA_PASSWORD="postgres"

# Read replica connection pool settings
DS_POSTGRES_READ_REPLICA_POOL_SIZE="5"
DS_POSTGRES_READ_REPLICA_MAX_OVERFLOW="10"

# ============================================
# Logging Configuration
# ============================================
# Log level: DEBUG, INFO, WARNING, ERROR (default: "INFO")
DS_LOG_LEVEL="INFO"

# ============================================
# Prometheus Metrics Configuration
# ============================================
# Enable Prometheus metrics collection (default: "true")
DS_METRICS_ENABLED="true"

# Metrics server host (default: "0.0.0.0")
DS_METRICS_HOST="0.0.0.0"

# Metrics server port (default: "8000")
DS_METRICS_PORT="8000"

# ============================================
# Grafana Configuration (for docker-compose)
# ============================================
# Grafana admin username (default: "admin")
GRAFANA_ADMIN_USER="admin"

# Grafana admin password (default: "admin")
# ‚ö†Ô∏è  SECURITY: Change this in production!
GRAFANA_ADMIN_PASSWORD="admin"
